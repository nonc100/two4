<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <title>TWO4 COSMOS</title>
  <style>
    :root{
      --bg:#0b1018; --panel:#111827; --text:#e8eefc; --muted:#9aa3b6;
      --up:#22c55e; --down:#ef4444;
      --glass-alpha:.30; --glass-blur:22px;
      --gb1: rgba(255,255,255,.32); --gb2: rgba(255,255,255,.14); --gb3: rgba(255,255,255,.06);
      --card-border: rgba(255,255,255,.08);

      --w-rank: 2.2ch; --w-coin: 9.5ch; --w-price: 8.8ch; --w-pct: 6.6ch; --w-spark: 100px;
      --toolbar-h: 58px;

      /* ⭐ 별 밝기/밀도 (0~1) */
      --starVis: .65;
    }
    *{box-sizing:border-box}
    html,body{
      margin:0;padding:0;
      background:radial-gradient(1200px 600px at 50% 0%, #182036 0%, var(--bg) 60%);
      color:var(--text);
      font:14px/1.5 ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR","Apple SD Gothic Neo","Malgun Gothic","Helvetica Neue",Arial,"Segoe UI Emoji";
      overflow-x:hidden
    }

    /* star bg */
    .sky{position:fixed; inset:0; pointer-events:none; z-index:0;}
    .stars,.stars2,.stars3{
      position:absolute; inset:0; background-repeat:repeat; background-size:1600px 1600px;
      animation:twinkle 18s linear infinite; filter:blur(.2px)
    }
    .stars{opacity:calc(.55 * var(--starVis));
      background-image:
        radial-gradient(1px 1px at 20px 30px,#fff8 50%,transparent 51%),
        radial-gradient(1px 1px at 120px 80px,#fff8 50%,transparent 51%),
        radial-gradient(1px 1px at 300px 120px,#fff8 50%,transparent 51%)}
    .stars2{opacity:calc(.35 * var(--starVis)); animation-duration:26s;
      background-image:
        radial-gradient(1px 1px at 40px 60px,#fff6 50%,transparent 51%),
        radial-gradient(1px 1px at 220px 140px,#fff6 50%,transparent 51%),
        radial-gradient(1px 1px at 460px 240px,#fff6 50%,transparent 51%)}
    .stars3{opacity:calc(.25 * var(--starVis)); animation-duration:34s;
      background-image:
        radial-gradient(1px 1px at 70px 20px,#fff5 50%,transparent 51%),
        radial-gradient(1px 1px at 260px 220px,#fff5 50%,transparent 51%),
        radial-gradient(1px 1px at 520px 420px,#fff5 50%,transparent 51%)}
    @keyframes twinkle{from{background-position:0 0} to{background-position:-1600px -1600px}}

    a{color:inherit;text-decoration:none}
    .wrap{position:relative; z-index:1; max-width:1220px; margin:0 auto; padding:0 16px 80px;}

    /* Brand */
    .brand{display:flex; align-items:center; gap:14px; margin:10px 0 8px;}
    .brand img{width:168px; height:auto; object-fit:contain;}
    .brand h1{margin:0; font-size:clamp(22px, 7vw, 40px); letter-spacing:.12em; font-weight:800; color:#dfe8ff; text-shadow:0 4px 24px rgba(114,157,255,.22);}
    .after-title{height:16px;}
    @media (max-width:767px){.brand{gap:10px;margin:8px 0 6px}.brand img{width:128px}.brand h1{letter-spacing:.08em}}

    /* ⭐ 상단 중앙 컨트롤러 */
    .star-ctl{
      position:fixed; top:6px; left:50%; transform:translateX(-50%);
      z-index:10; height:28px; display:flex; align-items:center; gap:8px;
      padding:4px 10px; border-radius:999px;
      backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
      background:linear-gradient(180deg, rgba(255,255,255,.18), rgba(255,255,255,.06));
      border:1px solid rgba(255,255,255,.22); color:#dbeafe; font-weight:800; font-size:12px;
    }
    .star-ctl input[type="range"]{width:110px; height:6px; background:transparent}
    .star-ctl input[type="range"]::-webkit-slider-thumb{appearance:none; width:14px; height:14px; border-radius:50%; background:#a78bfa; border:1px solid #fff9}
    .star-ctl input[type="range"]::-webkit-slider-runnable-track{height:6px; border-radius:999px; background:linear-gradient(90deg,#a78bfa,#22d3ee)}

    /* lists (우측 카드용) */
    .list{display:flex; flex-direction:column; gap:6px; margin-top:6px;}
    .list .row{display:grid; grid-template-columns:2.2em 1fr auto auto; align-items:center; gap:6px; font-size:13.5px;}
    .list .rank{text-align:right; opacity:.7; font-weight:700}
    .list .sym{font-weight:800; letter-spacing:.02em; color:#fff}
    .list .price{justify-self:end; opacity:.9; font-variant-numeric:tabular-nums}
    .list .pct{justify-self:end; font-weight:800; font-variant-numeric:tabular-nums}

    /* table */
    .controls{display:flex; gap:10px; align-items:center; margin:18px 0 10px;}
    .controls .search{flex:1}
    input[type="text"], select, button{background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12); color:var(--text); border-radius:10px; padding:9px 12px; outline:none}
    button.sortdir{min-width:40px}
    .table-wrap{overflow-x:auto}
    table{width:1200px; border-collapse:separate; border-spacing:0 10px;}
    thead th{position:sticky; top: calc(var(--toolbar-h) + 10px); background:rgba(17,24,39,.85); font-size:12px; color:var(--muted); font-weight:700; text-align:left; padding:0 10px; backdrop-filter:blur(6px)}
    tbody td{background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.08); padding:12px 10px; vertical-align:middle}
    tbody tr td:first-child{border-radius:12px 0 0 12px}
    tbody tr td:last-child{border-radius:0 12px 12px 0}
    .row-index{width:46px; text-align:right; opacity:.7; font-weight:700; position:sticky; left:0; background:rgba(17,24,39,.85); backdrop-filter:blur(6px); z-index:1}
    .coin-cell{display:flex; align-items:center; gap:10px; min-width:220px; position:sticky; left:46px; background:rgba(17,24,39,.85); backdrop-filter:blur(6px); z-index:1}
    .coin-img{width:22px; height:22px; min-width:22px; border-radius:50%; object-fit:contain}
    .coin-name{font-weight:800}
    .coin-sym{opacity:.85; margin-left:4px}
    .text-right{text-align:right}

    @media (max-width:1199px){table{width:1100px}}
    @media (max-width:767px){
      .cosmos-table{table-layout:fixed !important; width:1100px}
      .cosmos-table col.col-rank{width:var(--w-rank)!important}
      .cosmos-table col.col-coin{width:var(--w-coin)!important}
      .cosmos-table col.col-price{width:var(--w-price)!important}
      .cosmos-table col.col-ch24{width:var(--w-pct)!important}
      .cosmos-table col.col-spark{width:var(--w-spark)!important}
      /* hide columns on mobile */
      .cosmos-table th:nth-child(4),.cosmos-table td:nth-child(4),
      .cosmos-table th:nth-child(6),.cosmos-table td:nth-child(6),
      .cosmos-table th:nth-child(7),.cosmos-table td:nth-child(7),
      .cosmos-table th:nth-child(8),.cosmos-table td:nth-child(8){display:none!important}
      .row-index{width:var(--w-rank); padding:6px 3px; text-align:center}
      .coin-cell{left:var(--w-rank); min-width:var(--w-coin); gap:6px}
      .coin-img{width:16px;height:16px;min-width:16px}
      .coin-sym{display:none}
    }

    footer{margin:28px auto 0; max-width:1220px; color:#9aa3b6; opacity:.8; font-size:12px; text-align:center}

    /* 3D HUB */
    .hub-wrap{display:grid;grid-template-columns:minmax(320px,520px) 1fr;gap:16px;align-items:center;margin:10px 0 18px}
    .hub3d{
      position:relative;width:100%;max-width:520px;border-radius:50%;aspect-ratio:1/1;
      background:
        radial-gradient(120% 120% at 30% 30%, rgba(120,144,255,.28) 0%, rgba(80,42,150,.20) 35%, rgba(10,16,26,0) 62%),
        radial-gradient(60% 60% at 70% 70%, rgba(0,0,0,.35), rgba(0,0,0,0));
      box-shadow:
        inset 0 10px 26px rgba(180,200,255,.20),
        inset 0 -16px 46px rgba(0,0,0,.50),
        0 18px 48px rgba(0,0,0,.38),
        0 0 40px rgba(56,189,248,.20), 0 0 80px rgba(124,58,237,.16);
      backdrop-filter:blur(10px); -webkit-backdrop-filter:blur(10px);
      border:1px solid rgba(255,255,255,.10); z-index:2
    }
    @supports not (aspect-ratio:1/1){.hub3d::before{content:"";display:block;padding-top:100%}.hub3d>*{position:absolute;inset:0}}
    .hub3d svg{position:absolute;inset:0}

    .hub-center{
      position:absolute; inset:50% auto auto 50%; transform:translate(-50%,-50%);
      width:36%; height:36%; border-radius:50%;
      display:flex; flex-direction:column; align-items:center; justify-content:center; text-align:center;
      background:radial-gradient(100% 100% at 35% 30%, rgba(34,211,238,.18), rgba(99,102,241,.12) 60%, rgba(0,0,0,0) 80%);
      border:1px solid rgba(255,255,255,.14);
      box-shadow: inset 0 6px 26px rgba(255,255,255,.10), 0 0 50px rgba(124,58,237,.22), 0 0 80px rgba(56,189,248,.18)
    }
    .hub-center .val{font-size:clamp(22px,3.4vw,30px);font-weight:900;letter-spacing:.02em;margin:0;line-height:1.1}
    .hub-center .lbl{font-size:12px;color:#9aa3b6;letter-spacing:.06em;margin:4px 0 0;line-height:1.1}

    .hub-seg{
      cursor:pointer; filter:drop-shadow(0 0 0 rgba(124,58,237,0));
      transition:transform .18s ease, filter .18s ease, opacity .18s ease, stroke .18s ease;
      transform-box: fill-box; transform-origin: center;
      stroke: rgba(255,255,255,.12); stroke-width:1.2;
    }
    .hub-seg:hover{transform:scale(1.025); filter:drop-shadow(0 0 12px rgba(124,58,237,.65)) drop-shadow(0 0 26px rgba(56,189,248,.45)); stroke: rgba(255,255,255,.25)}
    .hub-seg.active{transform:scale(1.03); filter:drop-shadow(0 0 16px rgba(124,58,237,.85)) drop-shadow(0 0 36px rgba(56,189,248,.60)); stroke: rgba(255,255,255,.35)}

    /* 섹터 레이블(크게 + 그라데이션 + 글로우) */
    .hub-badge{
      font-weight:900;
      font-size:clamp(14px,1.6vw,18px); /* ⬅️ 크게 */
      letter-spacing:.02em;
      fill:url(#mintWhiteGrad);
      filter:url(#textGlow);
      pointer-events:none;
    }

    .hub-panel{position:relative; min-height:260px; border-radius:16px; padding:14px;
      background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
      border:1px solid rgba(255,255,255,.10); box-shadow:0 10px 30px rgba(0,0,0,.30); backdrop-filter:blur(14px)}
    .hub-panel.hidden{display:none}
    .hub-panel h4{margin:2px 0 10px; font-size:14px; color:#9aa3b6; letter-spacing:.08em}
    .hub-list{display:flex; flex-direction:column; gap:6px}
    .hub-row{display:grid; grid-template-columns:1.6em 1fr auto auto; gap:8px; align-items:center; font-size:13.5px}
    .hub-row .rk{opacity:.7;text-align:right;font-weight:800}
    .hub-row .tk{font-weight:900;color:#fff}
    .hub-row .px{opacity:.9;text-align:right}
    .hub-row .pc{font-weight:900;text-align:right}
    .hub-row .pc.up{color:#22c55e}.hub-row .pc.down{color:#ef4444}

    @media (max-width:767px){.hub-wrap{grid-template-columns:1fr}.hub3d{max-width:360px;margin:0 auto}}

    /* 기존 카드 영역 숨김 */
    .cards{display:none!important}
  </style>
</head>
<body>
  <!-- ⭐ 별 배경 -->
  <div class="sky"><div class="stars"></div><div class="stars2"></div><div class="stars3"></div></div>

  <!-- ⭐ 상단 중앙 컨트롤러 -->
  <div class="star-ctl" aria-label="Star background controller">
    <span>⭐</span>
    <input id="starRange" type="range" min="0" max="100" value="65" />
  </div>

  <div class="wrap">
    <div class="brand">
      <img src="/media/logo.png" alt="TWO4">
      <h1>COSMOS</h1>
    </div>

    <!-- 3D Hub -->
    <section class="hub-wrap">
      <div class="hub3d">
        <svg id="hubSvg" viewBox="0 0 1000 1000" role="img" aria-label="Cosmos overview hub">
          <!-- 공용 텍스트 그라데이션/글로우 정의 -->
          <defs>
            <linearGradient id="mintWhiteGrad" x1="0" y1="0" x2="0" y2="1">
              <stop offset="0%" stop-color="#dffff9"/>
              <stop offset="100%" stop-color="#7efcf3"/>
            </linearGradient>
            <filter id="textGlow" x="-50%" y="-50%" width="200%" height="200%">
              <feGaussianBlur stdDeviation="2" result="blur"/>
              <feMerge>
                <feMergeNode in="blur"/>
                <feMergeNode in="SourceGraphic"/>
              </feMerge>
            </filter>
          </defs>
        </svg>
        <div class="hub-center">
          <div class="val" id="hubVal">—</div>
          <div class="lbl" id="hubLbl">COSMOS</div>
        </div>
      </div>
      <aside class="hub-panel hidden" id="hubPanel">
        <h4 id="hubTitle">—</h4>
        <div id="hubContent"></div>
      </aside>
    </section>

    <!-- Controls -->
    <div class="controls">
      <input class="search" type="text" id="search" placeholder="코인 검색 (이름/심볼)">
      <label>정렬:
        <select id="sortkey">
          <option value="market_cap">시가총액</option>
          <option value="price">가격</option>
          <option value="volume">거래량</option>
          <option value="change1h">1시간</option>
          <option value="change24h">24시간</option>
          <option value="change7d">7일</option>
          <option value="rank">순위</option>
        </select>
      </label>
      <button id="sortdir" class="sortdir" title="정렬 방향">▼</button>
      <label>페이지:
        <select id="page"></select>
      </label>
    </div>

    <!-- Table -->
    <div class="table-wrap">
      <table class="cosmos-table">
        <colgroup>
          <col class="col-rank"><col class="col-coin"><col class="col-price">
          <col class="col-ch1h"><col class="col-ch24"><col class="col-ch7d">
          <col class="col-mcap"><col class="col-vol"><col class="col-spark">
        </colgroup>
        <thead>
          <tr>
            <th class="text-right">순위</th>
            <th>코인</th>
            <th class="text-right">시세</th>
            <th class="text-right">1시간</th>
            <th class="text-right">24시간</th>
            <th class="text-right">7일</th>
            <th class="text-right">시가총액</th>
            <th class="text-right">거래량</th>
            <th class="text-right">7일 차트</th>
          </tr>
        </thead>
        <tbody id="cosmos-tbody"></tbody>
      </table>
    </div>

    <footer>
      🚀 Cosmos 암호화폐 대시보드 – CoinGecko API, Alternative.me, Binance 데이터 | 3D 네온 허브 인터페이스 | 백엔드 프록시 지원 | 30초 자동 업데이트
    </footer>
  </div>

  <!-- 공용 스크립트 -->
  <script src="./cosmos.js"></script>

  <!-- ✅ cosmos.js 핫픽스: 일부 API 실패해도 표 그리기 + market_chart 무력화 -->
  <script>
  (function(){
    function patch(){
      if (window.fetchMarketChart) window.fetchMarketChart = async ()=>null;
      if (window._cosmos && typeof window._cosmos.initData === 'function') {
        const st = window._cosmos.state;
        window._cosmos.initData = async function(){
          try{
            const rs = await Promise.allSettled([
              fetchMarkets(), fetchGlobal(), fetchFNG(), fetchBinanceLS(st.lsPeriod)
            ]);
            const markets = rs[0].status==='fulfilled' ? rs[0].value : [];
            const global  = rs[1].status==='fulfilled' ? rs[1].value : null;
            const fng     = rs[2].status==='fulfilled' ? rs[2].value : null;
            const ls      = rs[3].status==='fulfilled' ? rs[3].value : null;

            st.all = Array.isArray(markets)? markets : [];
            renderKPIs(st.all, global);
            renderRightLists(st.all);
            applySortFilter();
            if (fng) renderFNGCard(fng);
            if (ls)  renderLongShort(st.lsPeriod, ls);
          }catch(e){ console.error(e); applySortFilter(); }
        };
        window._cosmos.initData();
      }
    }
    if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', patch);
    else patch();
  })();
  </script>

  <!-- ⭐ 컨트롤러 동작 -->
  <script>
    (function(){
      const range = document.getElementById('starRange');
      function apply(v){
        const n = Math.max(0, Math.min(1, v/100));
        document.documentElement.style.setProperty('--starVis', String(n));
      }
      range.addEventListener('input', e=>apply(e.target.value));
      apply(range.value);
    })();
  </script>

  <!-- 3D HUB 스크립트 -->
  <script>
  (function(){
    const TAU = Math.PI*2;
    const svg = document.getElementById('hubSvg');
    const centerVal = document.getElementById('hubVal');
    const centerLbl = document.getElementById('hubLbl');
    const panel = document.getElementById('hubPanel');
    const panelTitle = document.getElementById('hubTitle');
    const panelContent = document.getElementById('hubContent');

    function arcPath(cx, cy, r0, r1, a0, a1){
      const p=(r,a)=>[cx+r*Math.cos(a),cy+r*Math.sin(a)];
      const [x0,y0]=p(r1,a0),[x1,y1]=p(r1,a1),[x2,y2]=p(r0,a1),[x3,y3]=p(r0,a0);
      const laf=(a1-a0)>Math.PI?1:0;
      return `M ${x0} ${y0} A ${r1} ${r1} 0 ${laf} 1 ${x1} ${y1} L ${x2} ${y2} A ${r0} ${r0} 0 ${laf} 0 ${x3} ${y3} Z`;
    }
    function fmtPct(n){if(n==null||isNaN(n))return'-';const s=n>=0?'+':'';return s+n.toFixed(2)+'%'}
    function fmtNum(n){if(n==null||isNaN(n))return'-';const a=Math.abs(n);if(a>=1e12)return'$'+(n/1e12).toFixed(2)+'T';if(a>=1e9)return'$'+(n/1e9).toFixed(2)+'B';if(a>=1e6)return'$'+(n/1e6).toFixed(2)+'M';return '$'+Number(n).toLocaleString('en-US',{maximumFractionDigits:2})}
    function setCenter(lbl,val){centerLbl.textContent=lbl;centerVal.textContent=val}
    function listHTML(items,kind){
      return `<div class="hub-list">`+items.map((c,i)=>{
        const tk=(c.symbol||'').toUpperCase(), px=fmtNum(c.current_price);
        const pc=kind==='vol'?fmtNum(c.total_volume):fmtPct(c.price_change_percentage_24h);
        const cls=kind==='vol'?'':((c.price_change_percentage_24h||0)>=0?'up':'down');
        return `<div class="hub-row"><div class="rk">${i+1}</div><div class="tk">${tk}</div><div class="px">${px}</div><div class="pc ${cls}">${pc}</div></div>`;
      }).join('')+`</div>`;
    }
    function openPanel(s){panel.classList.remove('hidden');panelTitle.textContent=s.label;panelContent.innerHTML=s.html}

    function ensureDefs(){
      let defs = svg.querySelector('defs');
      if(!defs){ defs = document.createElementNS(svg.namespaceURI,'defs'); svg.appendChild(defs); }
      return defs;
    }

    function buildHub(sections){
      svg.innerHTML = svg.innerHTML; // defs 유지
      const cx=500,cy=500,rO=470,rI=260,seg=TAU/sections.length, start=-Math.PI/2;
      const defs = ensureDefs(); // (텍스트 그라디언트/글로우는 HTML 내에서 이미 존재)
      sections.forEach((s,i)=>{
        // 각 섹터용 배경 그라디언트
        const gid=`g${i}`;
        const grad=document.createElementNS(svg.namespaceURI,'linearGradient');
        grad.id=gid; grad.setAttribute('x1','0');grad.setAttribute('y1','0');grad.setAttribute('x2','1');grad.setAttribute('y2','1');
        const st1=document.createElementNS(grad.namespaceURI,'stop');st1.setAttribute('offset','0%');st1.setAttribute('stop-color','#7c3aed');st1.setAttribute('stop-opacity','.58');
        const st2=document.createElementNS(grad.namespaceURI,'stop');st2.setAttribute('offset','100%');st2.setAttribute('stop-color','#06b6d4');st2.setAttribute('stop-opacity','.46');
        grad.appendChild(st1);grad.appendChild(st2); defs.appendChild(grad);

        const a0=start+seg*i+0.014, a1=start+seg*(i+1)-0.014;
        const path=document.createElementNS(svg.namespaceURI,'path');
        path.setAttribute('d',arcPath(cx,cy,rI,rO,a0,a1));
        path.setAttribute('fill',`url(#${gid})`);
        path.setAttribute('opacity','.92');
        path.classList.add('hub-seg');
        svg.appendChild(path);

        // 레이블(큰 텍스트)
        const mid=(a0+a1)/2, rx=(rI+rO)/2, tx=cx+(rx-30)*Math.cos(mid), ty=cy+(rx-30)*Math.sin(mid)+6;
        const text=document.createElementNS(svg.namespaceURI,'text');
        text.setAttribute('x',tx); text.setAttribute('y',ty);
        text.setAttribute('text-anchor','middle');
        text.classList.add('hub-badge');
        text.textContent=s.badge;
        svg.appendChild(text);

        function act(){
          svg.querySelectorAll('.hub-seg').forEach(el=>el.classList.remove('active'));
          path.classList.add('active'); setCenter(s.label,s.center); openPanel(s);
        }
        path.addEventListener('mouseenter',()=>setCenter(s.label,s.center));
        path.addEventListener('click',act);
        text.addEventListener('click',act);
      });
    }

    async function gather(){
      const results=await Promise.allSettled([
        fetchMarkets(), fetchGlobal(), fetchFNG(),
        fetchBinanceLS('1h'), fetchBinanceLS('4h'), fetchBinanceLS('1d')
      ]);
      const get=(i,d=null)=>results[i].status==='fulfilled'?results[i].value:d;
      const markets=Array.isArray(get(0,[]))?get(0,[]):[], global=get(1,null), fng=get(2,null);
      const byId=Object.fromEntries(markets.map(m=>[m.id,m])); const btc=byId.bitcoin||null, usdt=byId.tether||null;
      const gainers=markets.filter(x=>Number.isFinite(x.price_change_percentage_24h)).sort((a,b)=>b.price_change_percentage_24h-a.price_change_percentage_24h).slice(0,10);
      const byVol=markets.slice().sort((a,b)=>b.total_volume-a.total_volume).slice(0,10);
      function parseLS(arr){const last=Array.isArray(arr)&&arr.length?arr[arr.length-1]:null; const ratio=last?Number(last.longShortRatio||0):0; const sp=ratio?100/(1+ratio):50; return {ratio,longPct:100-sp,shortPct:sp}}
      const ls={h1:parseLS(get(3,null)),h4:parseLS(get(4,null)),d1:parseLS(get(5,null))};
      return {markets,btc,usdt,gainers,byVol,dominance:(global?.data?.market_cap_percentage?.btc??0),fng:Array.isArray(fng?.data)?fng.data[0]:null,ls};
    }

    function listHTML(items,kind){
      return `<div class="hub-list">`+items.map((c,i)=>{
        const tk=(c.symbol||'').toUpperCase(), px=fmtNum(c.current_price);
        const pc=kind==='vol'?fmtNum(c.total_volume):fmtPct(c.price_change_percentage_24h);
        const cls=kind==='vol'?'':((c.price_change_percentage_24h||0)>=0?'up':'down');
        return `<div class="hub-row"><div class="rk">${i+1}</div><div class="tk">${tk}</div><div class="px">${px}</div><div class="pc ${cls}">${pc}</div></div>`;
      }).join('')+`</div>`;
    }

    async function initHub(){
      try{
        const d=await gather(); const fngLbl=d.fng?`${d.fng.value} / ${d.fng.value_classification||'—'}`:'—';
        const secs=[
          {label:'롱/숏 (1H)',badge:`${d.ls.h1.longPct.toFixed(0)}%`,center:`${d.ls.h1.longPct.toFixed(1)} / ${d.ls.h1.shortPct.toFixed(1)}%`,
           html:`<div>BTCUSDT 롱/숏 (1H)</div><div style="margin-top:8px;height:8px;background:rgba(255,255,255,.08);border-radius:999px;overflow:hidden"><div style="width:${d.ls.h1.longPct.toFixed(1)}%;height:100%;background:#22c55e"></div></div><div style="margin-top:6px;display:flex;justify-content:space-between"><div>Long ${d.ls.h1.longPct.toFixed(1)}%</div><div>Short ${d.ls.h1.shortPct.toFixed(1)}% · ratio ${d.ls.h1.ratio.toFixed(2)}</div></div>`},
          {label:'BTC 도미넌스',badge:`${(d.dominance||0).toFixed(0)}%`,center:`${(d.dominance||0).toFixed(2)}%`,html:`<div>BTC Dominance</div><div style="margin-top:6px">현재 ${(d.dominance||0).toFixed(2)}%</div>`},
          {label:'공포/탐욕',badge:d.fng?`${d.fng.value}`:'—',center:fngLbl,html:`<div>Alternative.me FNG</div><div style="margin-top:6px">${fngLbl}</div>`},
          {label:'BTC 시총',badge:d.btc?fmtNum(d.btc.market_cap):'—',center:d.btc?fmtNum(d.btc.market_cap):'—',html:`<div>BTC Market Cap</div><div style="margin-top:6px">${d.btc?fmtNum(d.btc.market_cap):'—'}</div>`},
          {label:'USDT 시총',badge:d.usdt?fmtNum(d.usdt.market_cap):'—',center:d.usdt?fmtNum(d.usdt.market_cap):'—',html:`<div>USDT Market Cap</div><div style="margin-top:6px">${d.usdt?fmtNum(d.usdt.market_cap):'—'}</div>`},
          {label:'24H % TOP10 [USDT]',badge:'TOP10',center:'+24H Gainers',html:`<div>24H % TOP10 [USDT]</div>${listHTML(d.gainers,'pct')}`},
          {label:'거래량 TOP10',badge:'VOL',center:'Volume Top10',html:`<div>거래량 TOP10</div>${listHTML(d.byVol,'vol')}`}
        ];
        buildHub(secs); setCenter('COSMOS','—');
      }catch(e){console.error(e); buildHub([{label:'COSMOS',badge:'—',center:'—',html:'<div>데이터를 불러오지 못했습니다.</div>'}]); setCenter('COSMOS','—')}
    }
    initHub(); setInterval(initHub,60*1000);
  })();
  </script>
</body>
</html>
