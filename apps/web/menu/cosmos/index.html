# apps/web/menu/cosmos/index.html

```html
<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TWO4 • Cosmos Dashboard</title>
  <link rel="icon" href="../../media/logo.png" />

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" />

  <!-- Chart.js for 상세 차트 -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>

  <style>
    :root {
      --bg: #0b0b18;
      --card:#0f1024cc;
      --card-strong:#121335cc;
      --glass: rgba(20, 20, 40, 0.5);
      --glass-strong: rgba(30, 30, 60, 0.55);
      --stroke: rgba(255,255,255,0.12);
      --stroke-strong: rgba(150,120,255,0.35);
      --txt:#e6e7ff;
      --muted:#9aa0c4;
      --accent:#a78bfa; /* purple */
      --up:#28e07a;
      --down:#ff5f7a;
      --warning:#ffd166;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: 'Poppins', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, 'Apple Color Emoji', 'Segoe UI Emoji';
      color: var(--txt);
      background: radial-gradient(1200px 800px at 80% -10%, rgba(120,60,255,0.25), transparent),
                  radial-gradient(800px 600px at -10% 110%, rgba(60,180,255,0.15), transparent),
                  var(--bg);
      overflow-x: hidden;
    }
    a { color: inherit; text-decoration: none; }

    /* Top Bar */
    .topbar {
      display:flex; align-items:center; gap:14px;
      padding: 18px clamp(16px, 3vw, 28px);
      position: sticky; top:0; z-index:50;
      backdrop-filter: blur(10px);
      background: linear-gradient(180deg, rgba(10,10,22,0.9), rgba(10,10,22,0.5));
      border-bottom: 1px solid var(--stroke);
    }
    .brand { font-weight:800; letter-spacing:2px; font-size: clamp(16px, 3.4vw, 28px);
      background: linear-gradient(90deg, #8b5cf6, #22d3ee, #8b5cf6);
      background-size: 200% 100%;
      -webkit-background-clip: text; background-clip:text; color: transparent;
      animation: moveSheen 8s linear infinite; }
    @keyframes moveSheen { 0% { background-position: 0% 50%; } 100% { background-position: 200% 50%; } }
    .logo { display:flex; align-items:center; gap:10px; }
    .logo img { width: 28px; height: 28px; border-radius: 8px; }
    .logo span { font-weight:600; letter-spacing:0.4px; }

    .container { width: min(1400px, 92vw); margin: 20px auto 120px; }

    /* Glass Cards */
    .info-grid {
      display: grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 16px;
    }
    .card {
      grid-column: span 2;
      background: linear-gradient(180deg, var(--glass), var(--glass-strong));
      border: 1px solid var(--stroke);
      border-radius: 18px;
      padding: 16px 16px 14px 16px;
      backdrop-filter: blur(12px);
      box-shadow: 0 10px 30px rgba(0,0,0,0.35), inset 0 1px 0 rgba(255,255,255,0.04);
      position: relative;
      overflow: hidden;
      min-height: 110px;
    }
    .mini { width: 100%; height: 36px; display:block; margin-top: 10px; opacity:0.95; }
    .card h4 { margin: 0 0 10px; font-weight: 600; font-size: 14px; color: var(--muted); }
    .stat { font-size: 22px; font-weight: 700; letter-spacing: 0.2px; }
    .sub { font-size: 12px; color: var(--muted); margin-top: 6px; }
    .badge { padding: 2px 8px; border-radius: 999px; font-size: 12px; border: 1px solid var(--stroke); }

    .card.span-3 { grid-column: span 3; }
    .list { margin: 8px 0 0; padding:0; list-style:none; max-height: 160px; overflow:auto; }
    .list li { display:flex; justify-content:space-between; align-items:center; font-size:13px; padding: 6px 0; border-bottom: 1px dashed rgba(255,255,255,0.06); }
    .list li:last-child { border-bottom: none; }
    .sym { opacity:0.9; font-weight:600; }
    .chg-up { color: var(--up); }
    .chg-dn { color: var(--down); }

    /* Controls */
    .controls { display:flex; align-items:center; justify-content:space-between; margin: 28px 0 12px; gap: 12px; }
    .search {
      display:flex; align-items:center; gap:10px; flex:1;
      background: linear-gradient(180deg, rgba(30,30,60,0.45), rgba(20,20,40,0.4));
      border:1px solid var(--stroke); border-radius:14px; padding: 10px 12px;
    }
    .search input { flex:1; background: transparent; color: var(--txt); border: none; outline: none; font-size: 14px; }
    .page-meta { font-size: 12px; color: var(--muted); }

    /* Table */
    .table-wrap { background: linear-gradient(180deg, var(--glass), var(--glass-strong)); border:1px solid var(--stroke); border-radius: 18px; overflow: hidden; }
    /* Mobile horizontal scroll to keep aspect */
    @media (max-width: 720px) {
      .table-wrap { overflow-x: auto; }
      table { min-width: 680px; }
    }
    table { width: 100%; border-collapse: collapse; font-size: 14px; }
    thead th {
      position: sticky; top: 0; backdrop-filter: blur(8px);
      background: linear-gradient(180deg, rgba(18,19,46,0.9), rgba(18,19,46,0.6));
      text-align: left; padding: 12px 10px; font-weight:600; color: var(--muted);
      border-bottom: 1px solid var(--stroke);
      cursor: pointer; user-select: none;
    }
    tbody td { padding: 12px 10px; border-bottom: 1px dashed rgba(255,255,255,0.06); }
    tbody tr:hover { background: rgba(140, 120, 255, 0.06); }

    .th-sort { display:inline-flex; align-items:center; gap:6px; }
    .th-sort .arrows { opacity: 0.5; font-size: 11px; line-height: 1; }
    th.sorted-asc .arrows::after { content: "▲"; }
    th.sorted-desc .arrows::after { content: "▼"; }
    th .arrows::after { content: "▲▼"; }

    .rank { color: var(--muted); font-weight:600; width: 38px; }
    .coin { display:flex; align-items:center; gap:10px; }
    .coin img { width: 20px; height: 20px; border-radius: 50%; }
    .sym2 { opacity:0.7; font-size: 12px; }
    .num-up { color: var(--up); font-weight: 600; }
    .num-dn { color: var(--down); font-weight: 600; }

    canvas.spark { width: 120px; height: 32px; display:block; }
    /* extra tiny */
    @media (max-width: 540px) {
      .hide-xs { display:none; }
    }

    /* Pagination */
    .pagination { display:flex; align-items:center; justify-content:flex-end; gap: 8px; padding: 12px; }
    .btn { background: linear-gradient(180deg, var(--card), var(--card-strong)); border:1px solid var(--stroke); color: var(--txt); padding: 8px 12px; border-radius: 12px; font-size: 13px; cursor:pointer; }
    .btn[disabled] { opacity:0.5; cursor:not-allowed; }

    /* Modal */
    .modal { position: fixed; inset:0; display:none; align-items:center; justify-content:center; background: rgba(0,0,0,0.6); backdrop-filter: blur(4px); z-index:100; }
    .modal.open { display:flex; }
    .modal-card { width:min(1080px, 92vw); background: linear-gradient(180deg, rgba(25,25,50,0.9), rgba(20,20,40,0.85)); border:1px solid var(--stroke-strong); border-radius: 18px; overflow: hidden; box-shadow: 0 20px 60px rgba(0,0,0,0.6); }
    .modal-head { display:flex; align-items:center; justify-content:space-between; padding: 14px 16px; border-bottom:1px solid var(--stroke); }
    .modal-title { font-weight:700; }
    .x { cursor:pointer; opacity:0.8; }
    .range { display:flex; gap: 8px; padding: 10px 14px; border-bottom:1px solid var(--stroke); flex-wrap: wrap; }
    .chip { border:1px solid var(--stroke); padding: 6px 10px; border-radius: 999px; font-size: 12px; cursor: pointer; }
    .chip.active { border-color: var(--stroke-strong); color: var(--accent); }
    .modal-body { padding: 12px; }

    /* Responsive */
    @media (max-width: 1100px) {
      .card { grid-column: span 4; }
      .card.span-3 { grid-column: span 6; }
    }
    @media (max-width: 720px) {
      .card { grid-column: span 6; }
      .card.span-3 { grid-column: span 12; }
      .sym2 { display:none; }
      .hide-sm { display:none; }
    }
  </style>
</head>
<body>
  <header class="topbar">
    <a class="logo" href="#">
      <img src="../../media/logo.png" alt="TWO4" />
      <span class="brand">COSMOS</span>
    </a>
  </header>

  <main class="container">
    <!-- 7 Glass Cards -->
    <section class="info-grid" aria-label="시장 요약">
      <article class="card" id="card-oi">
        <h4>BTC 미결제약정 (OI)</h4>
        <div class="stat" data-field="oi-value">—</div>
        <div class="sub">연동 예정 • 파생 API 합산</div>
      </article>
      <article class="card" id="card-fgi">
        <h4>공포/탐욕 지수</h4>
        <div class="stat" data-field="fgi-value">—</div>
        <div class="sub">연동 예정 • alternative.me</div>
      </article>
      <article class="card" id="card-dominance">
        <h4>BTC Dominance</h4>
        <div class="stat" data-field="dom-value">—</div>
        <div class="sub" data-field="dom-sub">—</div>
      </article>
      <article class="card" id="card-btc-mcap">
        <h4>BTC Market Cap</h4>
        <div class="stat" data-field="btc-mcap">—</div>
        <div class="sub">시총(USD)</div>
        <canvas class="mini" id="mini-btc-mcap"></canvas>
      </article>
      <article class="card" id="card-global-mcap">
        <h4>Global Market Cap</h4>
        <div class="stat" data-field="global-mcap">—</div>
        <div class="sub" data-field="global-sub">전체 암호화폐 시가총액(USD)</div>
        <canvas class="mini" id="mini-global-mcap"></canvas>
      </article>
      <article class="card span-3" id="card-top7">
        <h4>등락률 TOP 7 (24h)</h4>
        <ul class="list" id="list-top7"></ul>
      </article>
      <article class="card span-3" id="card-volume-rank">
        <h4>코인 거래량 순위 (24h)</h4>
        <ul class="list" id="list-volume"></ul>
      </article>
    </section>

    <!-- Controls -->
    <section class="controls">
      <div class="search">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M21 21l-4.35-4.35M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="currentColor" stroke-width="1.5"/></svg>
        <input id="searchInput" placeholder="코인 이름/심볼 검색… (예: btc, eth)" />
      </div>
      <div class="page-meta"><span id="pageMeta">—</span></div>
    </section>

    <!-- Table -->
    <section class="table-wrap">
      <table id="coinsTable">
        <thead>
          <tr>
            <th data-key="market_cap_rank" class="rank th-sort"># <span class="arrows"></span></th>
            <th data-key="name" class="th-sort">코인 <span class="arrows"></span></th>
            <th data-key="current_price" class="th-sort">가격 <span class="arrows"></span></th>
            <th data-key="price_change_percentage_1h_in_currency" class="th-sort hide-xs">1h <span class="arrows"></span></th>
            <th data-key="price_change_percentage_24h_in_currency" class="th-sort">24h <span class="arrows"></span></th>
            <th data-key="price_change_percentage_7d_in_currency" class="th-sort">7d <span class="arrows"></span></th>
            <th data-key="market_cap" class="th-sort">시총 <span class="arrows"></span></th>
            <th data-key="total_volume" class="th-sort">거래량(24h) <span class="arrows"></span></th>
            <th class="hide-sm">7d 스파크라인</th>
          </tr>
        </thead>
        <tbody id="coinsTbody"></tbody>
      </table>
      <div class="pagination">
        <button class="btn" id="prevBtn">이전</button>
        <span id="pageLabel" class="page-meta">—</span>
        <button class="btn" id="nextBtn">다음</button>
      </div>
    </section>
  </main>

  <!-- Modal: 상세 차트 -->
  <div class="modal" id="detailModal" aria-hidden="true" aria-label="상세 차트">
    <div class="modal-card">
      <div class="modal-head">
        <div class="modal-title" id="modalTitle">—</div>
        <div class="x" id="modalClose">✕</div>
      </div>
      <div class="range" id="rangeBtns">
        <button class="chip" data-days="1">24H</button>
        <button class="chip" data-days="7">7D</button>
        <button class="chip active" data-days="30">30D</button>
        <button class="chip" data-days="90">90D</button>
        <button class="chip" data-days="180">180D</button>
        <button class="chip" data-days="365">1Y</button>
      </div>
      <div class="modal-body">
        <canvas id="detailChart" height="360"></canvas>
      </div>
    </div>
  </div>

  <script src="./cosmos.js"></script>
</body>
</html>
```

---

# apps/web/menu/cosmos/cosmos.js

```js
/* TWO4 • Cosmos dashboard logic
   Proxy endpoints
   - /api/coins/markets
   - /api/global
   - /api/coins/:id/market_chart (expects ?vs_currency=usd&days=...)
*/

(() => {
  const API = {
    markets: '/api/coins/markets',
    global: '/api/global',
    chart: (id) => `/api/coins/${id}/market_chart`,
  };

  const state = {
    coins: [],
    filtered: [],
    page: 1,
    perPage: 50,
    sortKey: 'market_cap_rank',
    sortDir: 'asc',
    observer: null,
    chart: null,
    chartCoin: null,
    currency: 'usd',
  };

  // Utils
  const nf0 = new Intl.NumberFormat('en-US');
  const nf2 = new Intl.NumberFormat('en-US', { maximumFractionDigits: 2 });
  const currencyFmt = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', maximumFractionDigits: 0 });
  const currencyFmt2 = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', maximumFractionDigits: 2 });

  const qs = (s, el=document) => el.querySelector(s);
  const qsa = (s, el=document) => [...el.querySelectorAll(s)];

  const fmtPct = (v) => (v === null || v === undefined || Number.isNaN(v)) ? '—' : `${(v >= 0 ? '+' : '') + nf2.format(v)}%`;
  const pctClass = (v) => (v === null || v === undefined || Number.isNaN(v)) ? '' : (v >= 0 ? 'num-up' : 'num-dn');

  const clamp = (n, a, b) => Math.max(a, Math.min(b, n));

  function setSortIndicator() {
    qsa('thead th').forEach(th => th.classList.remove('sorted-asc','sorted-desc'));
    const th = qs(`thead th[data-key="${state.sortKey}"]`);
    if (th) th.classList.add(state.sortDir === 'asc' ? 'sorted-asc' : 'sorted-desc');
  }

  // Fetch data
  async function fetchMarkets() {
    const url = `${API.markets}?vs_currency=${state.currency}&order=market_cap_desc&per_page=250&sparkline=true&price_change_percentage=1h,24h,7d`;
    const res = await fetch(url);
    if (!res.ok) throw new Error('markets fetch failed');
    const data = await res.json();
    return data;
  }

  async function fetchGlobal() {
    const res = await fetch(API.global);
    if (!res.ok) throw new Error('global fetch failed');
    const data = await res.json();
    return data;
  }

  function renderHeaderCards({ coins, global }) {
    // Dominance & Global
    try {
      const dom = global?.data?.market_cap_percentage?.btc;
      const gcap = global?.data?.total_market_cap?.[state.currency];
      if (dom != null) qs('[data-field="dom-value"]').textContent = `${nf2.format(dom)}%`;
      if (gcap != null) {
        qs('[data-field="global-mcap"]').textContent = currencyFmt.format(gcap);
        qs('[data-field="global-sub"]').textContent = `전체 암호화폐 시가총액(USD)`;
      }
    } catch (e) { /* noop */ }

    // BTC Market Cap
    const btc = coins.find(c => c.id === 'bitcoin');
    if (btc) qs('[data-field="btc-mcap"]').textContent = currencyFmt.format(btc.market_cap);

    // Top7 by 24h %
    const top7 = [...coins]
      .filter(c => Number.isFinite(c.price_change_percentage_24h_in_currency))
      .sort((a,b) => b.price_change_percentage_24h_in_currency - a.price_change_percentage_24h_in_currency)
      .slice(0,7);
    const ulTop = qs('#list-top7');
    ulTop.innerHTML = top7.map(c => {
      const pct = c.price_change_percentage_24h_in_currency;
      const cls = pct >= 0 ? 'chg-up' : 'chg-dn';
      return `<li><span class="sym">${c.symbol.toUpperCase()}</span><span class="${cls}">${fmtPct(pct)}</span></li>`;
    }).join('');

    // Volume rank (top 7)
    const v7 = [...coins].sort((a,b) => b.total_volume - a.total_volume).slice(0,7);
    const ulVol = qs('#list-volume');
    ulVol.innerHTML = v7.map((c, i) => `<li><span class="sym">${i+1}. ${c.symbol.toUpperCase()}</span><span>${currencyFmt.format(c.total_volume)}</span></li>`).join('');
  }%`;
      if (gcap != null) {
        qs('[data-field="global-mcap"]').textContent = currencyFmt.format(gcap);
        qs('[data-field="global-sub"]').textContent = `24h: ${fmtPct(global?.data?.market_cap_change_percentage_24h_usd)}`;
      }
    } catch (e) { /* noop */ }

    // BTC Market Cap
    const btc = coins.find(c => c.id === 'bitcoin');
    if (btc) qs('[data-field="btc-mcap"]').textContent = currencyFmt.format(btc.market_cap);

    // Top7 by 24h %
    const top7 = [...coins]
      .filter(c => Number.isFinite(c.price_change_percentage_24h_in_currency))
      .sort((a,b) => b.price_change_percentage_24h_in_currency - a.price_change_percentage_24h_in_currency)
      .slice(0,7);
    const ulTop = qs('#list-top7');
    ulTop.innerHTML = top7.map(c => {
      const pct = c.price_change_percentage_24h_in_currency;
      const cls = pct >= 0 ? 'chg-up' : 'chg-dn';
      return `<li><span class="sym">${c.symbol.toUpperCase()}</span><span class="${cls}">${fmtPct(pct)}</span></li>`;
    }).join('');

    // Volume rank (top 7)
    const v7 = [...coins].sort((a,b) => b.total_volume - a.total_volume).slice(0,7);
    const ulVol = qs('#list-volume');
    ulVol.innerHTML = v7.map((c, i) => `<li><span class="sym">${i+1}. ${c.symbol.toUpperCase()}</span><span>${currencyFmt.format(c.total_volume)}</span></li>`).join('');
  }

  function applyFilter() {
    const q = qs('#searchInput').value.trim().toLowerCase();
    state.filtered = state.coins.filter(c => {
      if (!q) return true;
      return c.name.toLowerCase().includes(q) || c.symbol.toLowerCase().includes(q);
    });
    state.page = 1;
    renderTable();
      // header mini charts lazy
      setupMiniSparksObserver();
    } catch (e) { /* noop */ }
        } else if (el.id === 'mini-global-mcap') {
          // Approximate using top-100 coins sparkline * supply
          const top = state.coins.slice(0, 100).filter(c => Array.isArray(c.sparkline_in_7d?.price));
          if (top.length) {
            const len = top[0].sparkline_in_7d.price.length;
            const agg = new Array(len).fill(0);
            top.forEach(c => {
              const supply = (c.market_cap && c.current_price) ? (c.market_cap / c.current_price) : 0; // ~ circulating supply
              const s = c.sparkline_in_7d.price;
              for (let i=0;i<len;i++) agg[i] += s[i] * supply;
            });
            drawMini(el, agg);
          }
        }
        mini.unobserve(el);
      }
    }, { root: null, threshold: 0.1 });

    ['#mini-btc-mcap', '#mini-global-mcap'].forEach(s => {
      const el = qs(s);
      if (el) mini.observe(el);
    });
  }
      });
    }, { root: null, rootMargin: '0px', threshold: 0.1 });

    qsa('canvas.spark').forEach(c => state.observer.observe(c));
  }

  function drawSparkline(canvas, series) {
    const ctx = canvas.getContext('2d');
    const w = canvas.width = canvas.clientWidth * devicePixelRatio;
    const h = canvas.height = canvas.clientHeight * devicePixelRatio;
    const pad = 6 * devicePixelRatio;

    const min = Math.min(...series);
    const max = Math.max(...series);
    const rng = Math.max(1e-9, max - min);

    ctx.clearRect(0,0,w,h);

    // line
    ctx.lineWidth = 2 * devicePixelRatio;
    const up = series[series.length - 1] >= series[0];
    ctx.strokeStyle = up ? 'rgba(40, 224, 122, 0.9)' : 'rgba(255,95,122, 0.9)';
    ctx.beginPath();
    series.forEach((v, i) => {
      const x = pad + (i / (series.length - 1)) * (w - pad * 2);
      const y = pad + (1 - (v - min) / rng) * (h - pad * 2);
      if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
    });
    ctx.stroke();
  }

  // draw mini into header cards
  function drawMini(canvas, series) { drawSparkline(canvas, series); });
    ctx.stroke();
  }

  // Detail modal & chart
  async function openDetail(id) {
    const coin = state.coins.find(c => c.id === id);
    if (!coin) return;
    state.chartCoin = coin;

    qs('#modalTitle').textContent = `${coin.name} (${coin.symbol.toUpperCase()})`;
    showModal(true);
    qsa('#rangeBtns .chip').forEach(ch => ch.classList.remove('active'));
    qs('#rangeBtns .chip[data-days="30"]').classList.add('active');

    await loadChart(id, 30);
  }

  async function loadChart(id, days) {
    const url = `${API.chart(id)}?vs_currency=${state.currency}&days=${days}`;
    const res = await fetch(url);
    if (!res.ok) return;
    const data = await res.json();
    const series = data?.prices || [];

    const labels = series.map(p => new Date(p[0]));
    const values = series.map(p => p[1]);

    const ctx = qs('#detailChart').getContext('2d');
    if (state.chart) state.chart.destroy();

    state.chart = new Chart(ctx, {
      type: 'line',
      data: {
        labels,
        datasets: [{
          label: `${state.chartCoin?.symbol?.toUpperCase()} / USD`,
          data: values,
          borderWidth: 2,
          pointRadius: 0,
          tension: 0.2,
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        interaction: { mode: 'index', intersect: false },
        plugins: {
          legend: { display: false },
          tooltip: {
            callbacks: {
              label: (ctx) => `${currencyFmt2.format(ctx.parsed.y)}`
            }
          }
        },
        scales: {
          x: { ticks: { color: '#b8b9d6' }, grid: { color: 'rgba(255,255,255,0.06)' } },
          y: { ticks: { color: '#b8b9d6' }, grid: { color: 'rgba(255,255,255,0.06)' } },
        }
      }
    });
  }

  function showModal(open) {
    const m = qs('#detailModal');
    m.classList.toggle('open', !!open);
    m.setAttribute('aria-hidden', open ? 'false' : 'true');
  }

  // Events
  function bindEvents() {
    // Sorting
    qsa('thead th[data-key]').forEach(th => {
      th.addEventListener('click', () => {
        const key = th.getAttribute('data-key');
        if (state.sortKey === key) {
          state.sortDir = state.sortDir === 'asc' ? 'desc' : 'asc';
        } else {
          state.sortKey = key;
          state.sortDir = (key === 'market_cap_rank') ? 'asc' : 'desc';
        }
        renderTable();
      });
    });

    // Search
    qs('#searchInput').addEventListener('input', () => {
      applyFilter();
    });

    // Pagination
    qs('#prevBtn').addEventListener('click', () => { state.page = Math.max(1, state.page - 1); renderTable(); });
    qs('#nextBtn').addEventListener('click', () => {
      const pages = Math.max(1, Math.ceil(state.filtered.length / state.perPage));
      state.page = Math.min(pages, state.page + 1); renderTable();
    });

    // Modal close
    qs('#modalClose').addEventListener('click', () => showModal(false));
    qs('#detailModal').addEventListener('click', (e) => { if (e.target.id === 'detailModal') showModal(false); });

    // Range buttons
    qsa('#rangeBtns .chip').forEach(ch => ch.addEventListener('click', async () => {
      qsa('#rangeBtns .chip').forEach(x => x.classList.remove('active'));
      ch.classList.add('active');
      const days = ch.getAttribute('data-days');
      if (state.chartCoin) await loadChart(state.chartCoin.id, days);
    }));
  }

  async function init() {
    bindEvents();

    try {
      const [markets, global] = await Promise.all([fetchMarkets(), fetchGlobal()]);
      state.coins = markets;
      state.filtered = markets;
      renderHeaderCards({ coins: markets, global });
      renderTable();
    } catch (e) {
      console.error(e);
      qs('#coinsTbody').innerHTML = `<tr><td colspan="9">데이터 로딩 실패—프록시(API) 상태를 확인해주세요.</td></tr>`;
    }
  }

  document.addEventListener('DOMContentLoaded', init);
  window.addEventListener('resize', () => {
    // Re-render visible sparks on resize for crispness
    qsa('canvas.spark').forEach(c => {
      const id = c.dataset.spark?.replace('spark-','');
      const coin = state.coins.find(x => x.id === id);
      if (coin?.sparkline_in_7d?.price) drawSparkline(c, coin.sparkline_in_7d.price);
    });
    ['mini-btc-mcap','mini-global-mcap'].forEach(id => {
      const el = qs('#'+id);
      if (el) setupMiniSparksObserver();
    });
  });
})();
```
