<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>TWO4 COSMOS</title>
  <style>
    :root{
      --bg:#0b1018; --panel:#111827; --text:#e8eefc; --muted:#9aa3b6;
      --up:#22c55e; --down:#ef4444;
      --sticky-top: 90px;             /* JS에서 실측 보정 */
      --rank-w: 46px;                 /* 순위 칼럼 너비 */
      --name-w: 180px;                /* 모바일에서 심볼만 보이므로 축소 */
    }
    *{box-sizing:border-box}
    html,body{
      margin:0;padding:0;background:#0b1018;color:var(--text);
      font:14px/1.5 ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR","Apple SD Gothic Neo","Malgun Gothic";
      overflow-x:hidden;
    }
    a{color:inherit;text-decoration:none}
    img{max-width:100%;height:auto}

    /* ====== ★ 별 배경: Canvas (고밀도+큰 별, 슬라이더 연동) ====== */
    #starCanvas{
      position:fixed; inset:0; z-index:0; pointer-events:none;
      background: radial-gradient(1200px 700px at 50% -180px, #182036 0%, #0b1018 55%);
    }

    /* 상단 중앙 별 컨트롤러(아주 작게) */
    .star-ctl{
      position:fixed; top:10px; left:50%; transform:translateX(-50%);
      z-index:10; display:flex; align-items:center; gap:8px;
      padding:6px 10px; border-radius:999px;
      backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
      background:rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.2);
      font-size:12px; color:#dbeafe; font-weight:800;
    }
    .star-ctl input[type=range]{width:140px;height:6px;background:transparent}
    .star-ctl input[type=range]::-webkit-slider-runnable-track{height:6px;border-radius:999px;background:linear-gradient(90deg,#a78bfa,#22d3ee)}
    .star-ctl input[type=range]::-webkit-slider-thumb{appearance:none;width:14px;height:14px;border-radius:50%;background:#fff;border:1px solid #0002}

    /* 우측 상단 로고 고정 */
    .logo-fixed{
      position:fixed; top:10px; right:12px; z-index:10;
      display:flex; align-items:center; gap:8px;
      padding:6px 8px; border-radius:10px;
      background:rgba(17,24,39,.35); border:1px solid rgba(255,255,255,.12);
      backdrop-filter:blur(8px);
    }
    .logo-fixed img{height:22px; width:auto; display:block}

    .wrap{position:relative; z-index:1; max-width:1240px; margin:0 auto; padding: calc(var(--sticky-top) + 50px) 16px 80px;}

    /* ===== HUB & PANEL (구조만 유지: cosmos.js와 호환) ===== */
    .hub-grid{display:grid;grid-template-columns:minmax(280px,520px) 1fr;gap:18px;align-items:center;margin-bottom:10px}
    @media (max-width:900px){.hub-grid{grid-template-columns:1fr}}
    .hub{position:relative;aspect-ratio:1/1;border-radius:50%;
      background:radial-gradient(100% 100% at 35% 30%, rgba(34,211,238,.10) 0%, rgba(99,102,241,.08) 60%, transparent 80%);
      border:1px solid rgba(255,255,255,.10); box-shadow:inset 0 8px 28px rgba(255,255,255,.06), 0 18px 48px rgba(0,0,0,.35);
    }
    .hub svg{position:absolute;inset:0}
    .center-cap{
      position:absolute; inset:50% auto auto 50%; transform:translate(-50%,-50%);
      width:36%; height:36%; border-radius:50%; display:flex; flex-direction:column; align-items:center; justify-content:center; text-align:center;
      background:radial-gradient(100% 100% at 40% 35%, rgba(46,204,250,.16), rgba(124,58,237,.10) 60%, transparent 80%);
      border:1px solid rgba(255,255,255,.12);
    }
    .center-big{font-weight:900;font-size:clamp(16px,3.2vw,28px);letter-spacing:.02em;margin:0 0 4px}
    .center-sub{font-size:12px;color:var(--muted);margin:0}
    .panel{min-height:240px;border-radius:16px;padding:14px;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.10);backdrop-filter:blur(12px)}
    .panel h4{margin:2px 0 10px;font-size:14px;color:#b9c3d6;letter-spacing:.08em}

    /* ===== Controls ===== */
    .controls{display:flex;gap:10px;align-items:center;margin:14px 0 8px}
    .controls .search{flex:1}
    input[type=text]{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);color:var(--text);border-radius:10px;padding:9px 12px;outline:none}

    /* ===== Table ===== */
    .table-wrap{overflow-x:auto;margin-top:8px}
    table{width:1200px;border-collapse:separate;border-spacing:0 8px}

    /* THEAD: 오직 한 곳만 sticky (겹침 해결) */
    thead th{
      position:sticky; top:var(--sticky-top);
      background:rgba(17,24,39,.92); backdrop-filter:blur(8px);
      font-size:12px; color:#b9c3d6; font-weight:700; padding:10px 12px;
      z-index:6;
    }

    /* 폭(데스크톱) */
    .c-rank{width:var(--rank-w)}
    .c-name{width:var(--name-w)}
    .c-price,.c-1h,.c-24h,.c-7d,.c-mcap,.c-vol,.c-spark{width:120px}

    /* 본문 셀 */
    #mkt tbody td{
      background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.08);
      padding:12px 10px; vertical-align:middle;
    }
    #mkt tbody tr td:first-child{border-radius:12px 0 0 12px}
    #mkt tbody tr td:last-child{border-radius:0 12px 12px 0}

    /* 좌측 고정 셀(헤더 바로 아래 레이어) */
    #mkt .sticky-rank{ position:sticky; left:0; z-index:5; background:rgba(17,24,39,.92) }
    #mkt .sticky-name{ position:sticky; left:var(--rank-w); z-index:5; background:rgba(17,24,39,.92) }

    /* Name 셀 내용 */
    .mkt-name{ display:flex; align-items:center; gap:8px; min-width:120px; }
    .mkt-name img{ width:20px; height:20px; border-radius:50% }
    .mkt-name .sym{ font-weight:900; margin-right:6px }
    .mkt-name .full{ opacity:.85 }

    /* 숫자/색 */
    .num{ text-align:right; font-variant-numeric: tabular-nums; }
    .pct.up{ color:#22c55e } .pct.down{ color:#ef4444 }

    td.spark canvas{display:block;width:120px;height:28px}

    /* ===== 모바일 (<=800px): 심볼 + 가격 + 24H + 7D 스파크 ===== */
    @media (max-width:800px){
      :root{ --name-w:130px; }                 /* 심볼만이라 더 좁게 */
      .wrap{ padding-top: calc(var(--sticky-top) + 44px); }

      /* 풀네임 숨김 → 심볼만 */
      .mkt-name .full{ display:none !important; }

      /* 1h, 7d(퍼센트), 시총, 거래량 숨김 */
      .c-1h, .c-7d, .c-mcap, .c-vol{ display:none !important; }
      /* 헤더도 동일하게 숨김 */
      #mkt thead th:nth-child(4),
      #mkt thead th:nth-child(6),
      #mkt thead th:nth-child(7),
      #mkt thead th:nth-child(8){ display:none !important; }

      /* 가격/24h/스파크는 조금 더 넓게 */
      .c-price{ width:132px !important }
      .c-24h{ width:96px !important }
      .c-spark{ width:120px !important }
    }

    footer{margin:28px auto 0; max-width:1220px; color:#9aa3b6; opacity:.8; font-size:12px; text-align:center}
  </style>
</head>
<body>
  <!-- ★ 캔버스 별 배경 -->
  <canvas id="starCanvas"></canvas>

  <!-- ★ 상단 중앙 컨트롤러 -->
  <div class="star-ctl" aria-label="Star background controller">
    <span>Stars</span>
    <input id="starRange" type="range" min="0" max="100" value="85" />
  </div>

  <!-- 우측 상단 로고 -->
  <div class="logo-fixed">
    <img src="/media/logo.png" alt="TWO4">
  </div>

  <div class="wrap">
    <!-- HUB (구조 유지) -->
    <section class="hub-grid">
      <div class="hub">
        <svg id="hubSvg" viewBox="0 0 1000 1000" aria-label="Cosmos sectors"></svg>
        <div class="center-cap">
          <div class="center-big" id="cBig">COSMOS</div>
          <div class="center-sub" id="cSub">—</div>
        </div>
      </div>
      <aside class="panel" id="panel">
        <h4 id="pTitle">—</h4>
        <div id="pBody">Select a sector.</div>
      </aside>
    </section>

    <!-- 검색 -->
    <div class="controls">
      <input class="search" id="q" type="text" placeholder="Search coin (name/symbol)">
    </div>

    <!-- 표 -->
    <div class="table-wrap">
      <table id="mkt" class="cosmos-table">
        <colgroup>
          <col class="c-rank">
          <col class="c-name">
          <col class="c-price">
          <col class="c-1h">
          <col class="c-24h">
          <col class="c-7d">
          <col class="c-mcap">
          <col class="c-vol">
          <col class="c-spark">
        </colgroup>
        <thead>
          <tr>
            <th data-key="rank"     class="sticky-rank th th-sort">#</th>
            <th data-key="name"     class="sticky-name th th-sort">Name</th>
            <th data-key="price"    class="text-right th th-sort">Price</th>
            <th data-key="change1h" class="text-right th th-sort">1h</th>
            <th data-key="change24h"class="text-right th th-sort">24h</th>
            <th data-key="change7d" class="text-right th th-sort">7d</th>
            <th data-key="market_cap" class="text-right th th-sort">Market Cap</th>
            <th data-key="volume"     class="text-right th th-sort">24h Volume</th>
            <th class="text-right">7d Spark</th>
          </tr>
        </thead>
        <tbody id="mktBody"></tbody>
      </table>
    </div>

    <div id="pager" class="controls" style="justify-content:center;gap:6px"></div>

    <footer>Cosmos Dashboard · CoinGecko · Binance · Alternative.me · 30s auto refresh</footer>
  </div>

  <!-- ===== Sticky top 실측/적용 + 별 캔버스 드로잉 ===== -->
  <script>
    // sticky top 계산: 상단 컨트롤러 높이 + 여유
    (function fixStickyTop(){
      function apply(){
        const ctl = document.querySelector('.star-ctl');
        const h = (ctl ? ctl.offsetHeight : 0) + 16; // 여유
        document.documentElement.style.setProperty('--sticky-top', Math.max(70, h) + 'px');
      }
      window.addEventListener('resize', apply, {passive:true});
      document.addEventListener('DOMContentLoaded', apply);
      apply();
    })();

    // 고밀도/대형 별 캔버스
    (function starCanvas(){
      const cv = document.getElementById('starCanvas');
      if(!cv) return;
      const ctx = cv.getContext('2d');
      let W=0, H=0, dpr=1, stars=[], intensity=0.85, anim=null;

      function resize(){
        dpr = window.devicePixelRatio || 1;
        const vw = innerWidth, vh = innerHeight;
        W = Math.floor(vw*dpr); H = Math.floor(vh*dpr);
        cv.width = W; cv.height = H;
        cv.style.width = vw+'px'; cv.style.height = vh+'px';
        build();
      }

      function build(){
        // 기본 밀도(면적당): 0.18 ~ 0.65 사이 가변, 슬라이더 비율에 비례
        const baseDensity = 0.00022; // 화면 px 당 계수
        const count = Math.floor(W*H * baseDensity * intensity);
        stars.length = 0;
        for(let i=0;i<count;i++){
          const r = (Math.random()<0.8 ? (0.9+Math.random()*1.6) : (1.8+Math.random()*2.2)) * dpr; // 약간 더 큰 별 섞기
          stars.push({
            x: Math.random()*W,
            y: Math.random()*H,
            r,
            a: 0.6 + Math.random()*0.4,
            tw: 0.015 + Math.random()*0.035,
            ph: Math.random()*Math.PI*2
          });
        }
      }

      function loop(){
        ctx.clearRect(0,0,W,H);
        for(const s of stars){
          s.ph += s.tw;
          const alpha = s.a * (0.75 + 0.25*Math.sin(s.ph));
          ctx.globalAlpha = alpha * intensity;
          ctx.beginPath();
          ctx.arc(s.x,s.y,s.r,0,Math.PI*2);
          ctx.fillStyle = '#fff';
          ctx.fill();
        }
        ctx.globalAlpha = 1;
        anim = requestAnimationFrame(loop);
      }

      function setIntensity(v){
        intensity = Math.max(0, Math.min(1, v));
        build();
        if(!anim) anim = requestAnimationFrame(loop);
      }

      // 연결: 상단 슬라이더
      const r = document.getElementById('starRange');
      if(r){
        const apply = ()=> setIntensity((+r.value||0)/100);
        r.addEventListener('input', apply);
        apply();
      }else{
        setIntensity(intensity);
      }

      addEventListener('resize', resize);
      resize();
      loop();
    })();
  </script>

  <!-- 기존 로직 유지 -->
  <script src="./cosmos.js"></script>
</body>
</html>
