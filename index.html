<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TWO.4 – Infinity Clock</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Space+Grotesk:wght@300;400;500;600;700&family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet"/>

  <style>
    /* ========== Reset / Base ========== */
    *{margin:0;padding:0;box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{
      font-family:'Inter',sans-serif;
      background:#000;
      color:#fff;
      line-height:1.6;
      min-height:100vh;
      overflow-x:hidden;
    }

    /* ========== Background Video ========== */
    .video-background{
      position:fixed; inset:0;
      width:100vw; height:100vh;
      min-width:100%; min-height:100%;
      object-fit:cover; object-position:center;
      z-index:-10;
      background:#000;
    }
    /* 방향에 따라 프레이밍 조금 보정(필요시 숫자만 미세조절) */
    @media (orientation:portrait){
      .video-background{ object-position:center 32% }
    }
    .video-overlay{
      position:fixed; inset:0;
      background:rgba(0,0,0,.28);
      z-index:-5; pointer-events:none;
    }

    /* ========== Top-left Logo ========== */
    .brand-logo{
      position:fixed;
      top:12px; left:16px;
      z-index:1200; display:block;
      pointer-events:auto;
    }
    .brand-logo img{
      display:block;
      height:clamp(28px,4.2vw,44px);
      width:auto;
      filter:drop-shadow(0 2px 8px rgba(0,0,0,.35));
      opacity:.95;
    }
    @media (max-width:768px){
      .brand-logo{ top:8px; left:12px }
    }

    /* ========== Nav (Menu button) ========== */
    .nav{
      position:fixed;
      top:20px; right:24px;
      z-index:1200;
      display:flex; align-items:center; gap:20px;
    }
    .nav-home{ display:none } /* 홈 텍스트는 숨김(로고가 홈 역할) */

    .menu-btn{
      width:54px; height:54px;
      background:rgba(139,92,246,.2);
      border:2px solid rgba(139,92,246,.4);
      border-radius:50%;
      cursor:pointer; display:flex; align-items:center; justify-content:center;
      transition:all .25s ease;
      backdrop-filter:blur(18px);
    }
    .menu-btn:hover{
      background:rgba(139,92,246,.3);
      border-color:rgba(139,92,246,.7);
      box-shadow:0 0 30px rgba(139,92,246,.45);
    }
    .menu-icon{ width:22px; height:22px; position:relative }
    .menu-line{
      position:absolute; left:0; width:22px; height:2px; background:#8b5cf6; transition:.25s
    }
    .menu-line:nth-child(1){ top:0 }
    .menu-line:nth-child(2){ top:8px }
    .menu-line:nth-child(3){ top:16px }

    /* ========== Infinity Clock (네 코드) ========== */
    .infinity-clock{
      position:absolute;
      top: clamp(4px, 1.5vh, 12px);
      left:50%; transform:translateX(-50%);
      display:flex; flex-direction:column; align-items:center;
      gap: clamp(3px, .6vh, 6px);
      pointer-events:none; z-index:1200;
    }
    .inf-svg{ width:clamp(200px,35vw,400px); height:auto }
    .esc{ font:600 clamp(13px,2.4vw,17px) 'Space Grotesk',system-ui,sans-serif; fill:rgba(255,255,255,.85); letter-spacing:1.5px }
    .inf-base{ fill:none; stroke:rgba(255,255,255,.12); stroke-width:6; stroke-linecap:round }
    .inf-prog{ fill:none; stroke:url(#inf-grad); stroke-width:6; stroke-linecap:round }
    .inf-cursor{ fill:rgba(255,255,255,.9) }
    .inf-mark{ fill:rgba(255,255,255,.35) }
    .inf-digital{
      font-family:'Space Grotesk',system-ui,sans-serif; font-weight:500;
      font-size:clamp(12px,1.8vw,16px); color:rgba(255,255,255,.95); letter-spacing:1px;
      background:rgba(0,0,0,.15);
      padding: clamp(6px,1vw,10px) clamp(10px,1.8vw,16px);
      border-radius:8px; border:1px solid rgba(255,255,255,.06); backdrop-filter:blur(8px)
    }
    .time-quote{
      font-family:'Space Grotesk',system-ui,sans-serif; font-weight:300;
      font-size:clamp(9px,1.2vw,11px); color:rgba(255,255,255,.55);
      text-align:center; margin-top: clamp(4px,.8vh,8px);
      line-height:1.3; letter-spacing:.2px; font-style:italic
    }
    @media (max-width:768px){
      .infinity-clock{ top: clamp(2px,1vh,8px) }
      .inf-svg{ width:clamp(280px,85vw,400px) }
    }

    /* ========== Content (복원) ========== */
    .content-section{
      background:rgba(0,0,0,.82);
      backdrop-filter:blur(20px);
      min-height:100vh;
      padding:100px 20px 120px;
      border-top:1px solid rgba(139,92,246,.3);
      position:relative; z-index:1;
    }
    .container{ max-width:1200px; margin:0 auto }
    .section-title{
      font-family:'Space Grotesk',sans-serif;
      font-size:3rem; font-weight:700; text-align:center; margin-bottom:3rem;
      color:#8b5cf6; text-shadow:0 0 30px rgba(139,92,246,.8)
    }
    .section-content{ display:grid; gap:3rem }

    .chart-container{
      background:rgba(139,92,246,.05);
      border:1px solid rgba(139,92,246,.3);
      border-radius:20px; padding:2rem;
      box-shadow:0 20px 40px rgba(0,0,0,.3);
      height:600px; position:relative; overflow:hidden
    }
    .chart-container::before{
      content:''; position:absolute; inset:0; left:-100%;
      background:linear-gradient(90deg,transparent,rgba(139,92,246,.12),transparent);
      animation:shimmer 3s ease-in-out infinite
    }
    @keyframes shimmer{ 0%{left:-100%} 100%{left:100%} }

    .chart-header{
      display:flex; justify-content:space-between; align-items:center;
      margin-bottom:20px; padding-bottom:15px; border-bottom:1px solid rgba(139,92,246,.2)
    }
    .chart-controls{ display:flex; gap:15px; align-items:center }
    .chart-selector{
      background:rgba(139,92,246,.1);
      border:1px solid rgba(139,92,246,.3);
      color:#fff; padding:8px 12px; border-radius:8px; font-size:14px; outline:none;
      transition:.25s
    }
    .chart-selector:focus{ border-color:rgba(139,92,246,.6); box-shadow:0 0 15px rgba(139,92,246,.3) }
    .chart-selector option{ background:#000; color:#fff }

    .chart-legend{ display:flex; gap:20px; flex-wrap:wrap }
    .legend-item{ display:flex; align-items:center; gap:8px; font-size:12px; font-weight:500; color:rgba(255,255,255,.85); cursor:pointer; transition:.25s }
    .legend-item:hover{ color:#fff; transform:translateY(-1px) }
    .legend-color{ width:12px; height:3px; border-radius:2px }
    .price-display{ color:#8b5cf6; font-weight:600; font-size:16px; font-family:'Orbitron',monospace }

    .cosmos-chart-canvas{
      width:100%; height:480px; background:rgba(0,0,0,.2); border-radius:10px;
      border:1px solid rgba(139,92,246,.1); cursor:crosshair
    }

    .news-grid,.coin-grid{ display:grid; grid-template-columns:repeat(auto-fit,minmax(300px,1fr)); gap:2rem }
    .news-card,.coin-card{
      background:rgba(139,92,246,.05);
      border:1px solid rgba(139,92,246,.2);
      border-radius:15px; padding:2rem; transition:.25s; backdrop-filter:blur(10px)
    }
    .news-card:hover,.coin-card:hover{
      background:rgba(139,92,246,.1); border-color:rgba(139,92,246,.4);
      transform:translateY(-5px); box-shadow:0 20px 40px rgba(139,92,246,.2)
    }
    .card-title{ color:#8b5cf6; font-size:1.2rem; font-weight:600; margin-bottom:1rem }
    .card-content{ color:rgba(255,255,255,.82) }

    /* ========== Menu Overlay (복원) ========== */
    .menu-overlay{
      position:fixed; top:0; right:-450px; width:450px; height:100vh;
      background:rgba(0,0,0,.97); backdrop-filter:blur(30px);
      border-left:2px solid rgba(139,92,246,.4);
      z-index:2000; transition:right .4s ease;
      padding:80px 40px 40px; overflow-y:auto
    }
    .menu-overlay.active{ right:0 }
    .menu-close{
      position:absolute; top:30px; right:30px; width:40px; height:40px; cursor:pointer;
      display:flex; align-items:center; justify-content:center;
      color:#8b5cf6; font-size:24px; transition:.25s; border-radius:50%;
      border:1px solid rgba(139,92,246,.35)
    }
    .menu-close:hover{ color:#fff; background:rgba(139,92,246,.2); border-color:rgba(139,92,246,.65) }
    .menu-section{ margin-bottom:30px }
    .menu-items{ list-style:none }
    .menu-item{ margin-bottom:6px }
    .menu-link{
      color:rgba(255,255,255,.85); text-decoration:none; font-size:14px; font-weight:500;
      font-family:'Space Grotesk',sans-serif; text-transform:uppercase; letter-spacing:1px;
      transition:.25s; display:block; padding:10px 16px; border-radius:8px; position:relative
    }
    .menu-link:hover{ color:#fff; background:rgba(139,92,246,.1); transform:translateX(8px); text-shadow:0 0 15px rgba(139,92,246,.6) }
    .korean-desc{ color:rgba(139,92,246,.85); font-size:12px; font-weight:400; text-transform:none; letter-spacing:0; margin-left:8px; display:none }
    .menu-link:hover .korean-desc{ display:inline }
    .menu-link.featured{
      background:linear-gradient(135deg,rgba(139,92,246,.15),rgba(168,85,247,.1));
      border:1px solid rgba(139,92,246,.3); font-weight:600; color:rgba(139,92,246,.92)
    }
    .menu-link.featured:hover{
      background:linear-gradient(135deg,rgba(139,92,246,.25),rgba(168,85,247,.15));
      border-color:rgba(139,92,246,.6); color:#fff; box-shadow:0 0 20px rgba(139,92,246,.4)
    }

    /* ========== Chat Button ========== */
    .chat-button{
      position:fixed; bottom:28px; right:28px;
      background:linear-gradient(135deg,#8b5cf6,#7c3aed);
      color:#fff; border:none; padding:16px 24px; border-radius:50px; cursor:pointer;
      box-shadow:0 10px 30px rgba(139,92,246,.4); z-index:1000; font-weight:600; font-size:16px;
      transition:.25s; backdrop-filter:blur(10px); border:2px solid rgba(139,92,246,.3); animation:chatPulse 2s ease-in-out infinite
    }
    @keyframes chatPulse{ 0%,100%{transform:scale(1); box-shadow:0 10px 30px rgba(139,92,246,.4)} 50%{transform:scale(1.05); box-shadow:0 15px 40px rgba(139,92,246,.6)} }
    .chat-button:hover{ transform:translateY(-3px) }

    /* ========== Mobile tweaks ========== */
    @media (max-width:768px){
      .nav{ top:16px; right:16px }
      .menu-overlay{ width:100%; right:-100% }
      .content-section{ padding:60px 20px 100px }
      .section-title{ font-size:2rem }
      .chart-header{ flex-direction:column; gap:15px; align-items:flex-start }
      .chart-legend{ justify-content:center }
    }
  </style>
</head>
<body>
  <!-- Background -->
  <video class="video-background" autoplay muted loop playsinline preload="auto" id="bgVideo">
    <source src="/background-portrait.mp4" type="video/mp4" media="(orientation: portrait)">
    <source src="/background.mp4" type="video/mp4" media="(orientation: landscape)">
    <source src="/background.mp4" type="video/mp4">
  </video>
  <div class="video-overlay"></div>

  <!-- Logo -->
  <a href="/" class="brand-logo" aria-label="TWO.4 home">
    <img src="/logo1.png" alt="TWO.4">
  </a>

  <!-- Nav -->
  <nav class="nav">
    <a href="#home" class="nav-home">Home</a>
    <div class="menu-btn" id="menuButton" aria-label="Open menu">
      <div class="menu-icon">
        <div class="menu-line"></div>
        <div class="menu-line"></div>
        <div class="menu-line"></div>
      </div>
    </div>
  </nav>

  <!-- Infinity Clock -->
  <div class="infinity-clock">
    <svg class="inf-svg" viewBox="0 0 600 280">
      <defs>
        <linearGradient id="inf-grad" x1="0" y1="0" x2="1" y2="0">
          <stop offset="0"    stop-color="#10b981"/>
          <stop offset="0.25" stop-color="#eab308"/>
          <stop offset="0.5"  stop-color="#f59e0b"/>
          <stop offset="0.75" stop-color="#ef4444"/>
          <stop offset="1"    stop-color="#dc2626"/>
        </linearGradient>
      </defs>
      <text x="300" y="32" text-anchor="middle" class="esc">E-SC</text>
      <path id="infBase" d="M300 140 C250 60 110 60 110 140 S250 220 300 140 S490 60 490 140 S350 220 300 140" class="inf-base"/>
      <path id="infProg" d="M300 140 C250 60 110 60 110 140 S250 220 300 140 S490 60 490 140 S350 220 300 140" class="inf-prog"/>
      <circle id="infCursor" r="4" class="inf-cursor"/>
      <circle id="markA" r="3" class="inf-mark"/>
      <circle id="markB" r="3" class="inf-mark"/>
    </svg>
    <div class="inf-digital" id="infDigital">AM 00:00:00</div>
    <div class="time-quote" id="timeQuote">Time is what we want most, but what we use worst.</div>
  </div>

  <!-- Main -->
  <main id="home"></main>

  <!-- Content (복원) -->
  <section class="content-section">
    <div class="container">
      <div class="section-content">
        <h2 class="section-title">COSMOS CHART</h2>
        <div class="chart-container">
          <div class="chart-header">
            <div class="chart-controls">
              <select id="timeSelector" class="chart-selector">
                <option value="1">1D</option>
                <option value="7" selected>7D</option>
                <option value="30">30D</option>
                <option value="90">90D</option>
              </select>
              <select id="chartType" class="chart-selector">
                <option value="multi" selected>Multi Coins</option>
                <option value="single">Single Coin</option>
              </select>
              <span class="price-display" id="marketCap">COSMOS Ready...</span>
            </div>
            <div class="chart-legend" id="chartLegend"></div>
          </div>
          <canvas id="cosmosChart" class="cosmos-chart-canvas"></canvas>
        </div>
      </div>

      <div class="section-content">
        <h2 class="section-title">Coin News</h2>
        <div class="news-grid">
          <div class="news-card">
            <h3 class="card-title">최신 암호화폐 뉴스 1</h3>
            <div class="card-content">비트코인이 새로운 최고가를 경신하며 시장에 활기를 불어넣고 있습니다. 기관 투자자들의 지속적인 유입이 주요 요인으로 분석됩니다.</div>
          </div>
          <div class="news-card">
            <h3 class="card-title">최신 암호화폐 뉴스 2</h3>
            <div class="card-content">이더리움 네트워크 업그레이드가 성공적으로 완료되어 거래 속도 향상과 수수료 절감 효과가 기대됩니다.</div>
          </div>
          <div class="news-card">
            <h3 class="card-title">최신 암호화폐 뉴스 3</h3>
            <div class="card-content">DeFi 프로토콜들이 새로운 혁신을 선보이며 전통 금융과의 융합이 가속화되고 있습니다.</div>
          </div>
        </div>
      </div>

      <div class="section-content" style="text-align:center;">
        <h2 class="section-title">사용자 게시판</h2>
        <p style="font-size:1.2rem;margin-bottom:2rem;color:rgba(255,255,255,.7)">방문자들의 이야기를 나누는 공간</p>
        <div style="display:flex;justify-content:center;gap:2rem;flex-wrap:wrap">
          <div class="coin-card" style="max-width:300px;">
            <h3 class="card-title">일반 토론</h3>
            <div class="card-content">자유롭게 의견을 나누는 공간</div>
          </div>
          <div class="coin-card" style="max-width:300px;">
            <h3 class="card-title">투자 전략</h3>
            <div class="card-content">투자 경험과 노하우 공유</div>
          </div>
          <div class="coin-card" style="max-width:300px;">
            <h3 class="card-title">Q&amp;A</h3>
            <div class="card-content">궁금한 점들을 해결하는 공간</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Menu Overlay -->
  <div class="menu-overlay" id="menuOverlay" aria-hidden="true">
    <div class="menu-close" id="menuClose" aria-label="Close">×</div>
    <div class="menu-section">
      <ul class="menu-items">
        <li class="menu-item"><a href="/charts" class="menu-link">COSMOS (CHARTS)<span class="korean-desc">차트</span></a></li>
        <li class="menu-item"><a href="/signals" class="menu-link">ORBITS (SIGNALS / INDICATORS)<span class="korean-desc">지표/신호</span></a></li>
        <li class="menu-item"><a href="/technique" class="menu-link">METHOD (TECHNIQUE)<span class="korean-desc">매매 기법</span></a></li>
        <li class="menu-item"><a href="/psyche" class="menu-link">PSYCHE<span class="korean-desc">마음과 철학, 멘탈</span></a></li>
      </ul>
    </div>
    <div class="menu-section">
      <ul class="menu-items">
        <li class="menu-item"><a href="/observations" class="menu-link">ECHOES (OBSERVATIONS / NEWS)<span class="korean-desc">사건의 메아리, 관찰 기록</span></a></li>
        <li class="menu-item"><a href="/community" class="menu-link">CONSTELLATION (COMMUNITY)<span class="korean-desc">사용자 커뮤니티</span></a></li>
        <li class="menu-item"><a href="/alerts" class="menu-link">BEACONS (ALERTS)<span class="korean-desc">주의</span></a></li>
      </ul>
    </div>
    <div class="menu-section">
      <ul class="menu-items">
        <li class="menu-item"><a href="/seed" class="menu-link featured">SEED ORACLE (SEED AI Q/A)<span class="korean-desc">seed AI (챗봇 서비스)</span></a></li>
        <li class="menu-item"><a href="/portal" class="menu-link featured">PORTAL<span class="korean-desc">(가입/로그인/로그아웃)</span></a></li>
      </ul>
    </div>
  </div>

  <button class="chat-button" id="chatButton">채팅하기</button>

  <script>
    /* 비디오가 일부 기기에서 자동재생 멈추는 경우 대비 */
    (function ensureVideoPlays(){
      const v=document.getElementById('bgVideo');
      if(!v) return;
      const tryPlay=()=>v.play().catch(()=>{});
      document.addEventListener('touchstart',tryPlay,{once:true});
      document.addEventListener('click',tryPlay,{once:true});
    })();

    /* 메뉴 토글 */
    const menuBtn=document.getElementById('menuButton');
    const menuClose=document.getElementById('menuClose');
    const menuOverlay=document.getElementById('menuOverlay');
    function toggleMenu(){ menuOverlay.classList.toggle('active') }
    menuBtn && menuBtn.addEventListener('click',toggleMenu);
    menuClose && menuClose.addEventListener('click',toggleMenu);
    document.addEventListener('click',e=>{
      if(menuOverlay && menuBtn && !menuOverlay.contains(e.target) && !menuBtn.contains(e.target)){
        menuOverlay.classList.remove('active');
      }
    });
    document.getElementById('chatButton')?.addEventListener('click',()=>alert('SEED ORACLE 채팅 기능 준비중입니다.'));

    /* ===== Infinity Clock (그대로) ===== */
    const dailyQuotes=[
      "Time is what we want most, but what we use worst.",
      "Lost time is never found again.",
      "Time flies over us, but leaves its shadow behind.",
      "The two most powerful warriors are patience and time.",
      "Time is a created thing. Say 'I don't have time,' not 'I don't have time.'",
      "Time you enjoy wasting is not wasted time.",
      "Yesterday is gone. Tomorrow has not yet come. We have only today."
    ];
    function initClock(){
      const base=document.getElementById('infBase');
      const prog=document.getElementById('infProg');
      const cursor=document.getElementById('infCursor');
      const digital=document.getElementById('infDigital');
      const timeQuote=document.getElementById('timeQuote');
      const markA=document.getElementById('markA');
      const markB=document.getElementById('markB');
      if(!base||!prog) return;

      const totalLength=base.getTotalLength();
      prog.style.strokeDasharray=`0 ${totalLength}`;
      const secondsToLength=sec=>((sec%60)/60)*totalLength;
      const place=(el,len)=>{ const p=base.getPointAtLength(len); el.setAttribute('cx',p.x); el.setAttribute('cy',p.y) };
      place(markA,secondsToLength(15));
      place(markB,secondsToLength(45));

      function update(){
        const now=new Date();
        const s=now.getSeconds();
        const len=secondsToLength(s);
        prog.style.strokeDasharray=`${len} ${totalLength-len}`;
        place(cursor,len);

        const h=now.getHours(), m=now.getMinutes();
        const hh=String(((h+11)%12)+1).padStart(2,'0');
        const mm=String(m).padStart(2,'0');
        const ss=String(s).padStart(2,'0');
        const ampm=h<12?'AM':'PM';
        digital.textContent=`${ampm} ${hh}:${mm}:${ss}`;

        const dow=now.getDay(); const idx=dow===0?6:dow-1;
        timeQuote.textContent=dailyQuotes[idx];
      }
      update(); setInterval(update,1000);
    }
    document.addEventListener('DOMContentLoaded',initClock);

    /* ===== COSMOS 차트 엔진 (복원, 간결화 버전) ===== */
    let chartCanvas=null, chartContext=null, currentData=new Map();
    const cryptoConfig=[
      {id:'bitcoin',name:'BTC',color:'#ff9500',visible:true,basePrice:112154},
      {id:'ethereum',name:'ETH',color:'#627eea',visible:true,basePrice:3680},
      {id:'binancecoin',name:'BNB',color:'#f0b90b',visible:true,basePrice:715},
      {id:'solana',name:'SOL',color:'#9945ff',visible:true,basePrice:185},
      {id:'cardano',name:'ADA',color:'#0066cc',visible:true,basePrice:1.12},
      {id:'ripple',name:'XRP',color:'#00d4aa',visible:true,basePrice:5.124},
      {id:'avalanche-2',name:'AVAX',color:'#e84142',visible:true,basePrice:52},
      {id:'dogecoin',name:'DOGE',color:'#c2a633',visible:true,basePrice:.384}
    ];

    function initCosmosChart(){
      chartCanvas=document.getElementById('cosmosChart');
      if(!chartCanvas) return;
      chartContext=chartCanvas.getContext('2d');
      resizeChart();
      createChartLegend();
      generateAllCosmosData();
      startChartAnimation();
      startRealTimeUpdates();
      window.addEventListener('resize',resizeChart);
      document.getElementById('marketCap').textContent='COSMOS Live: $3.85T';
    }
    function resizeChart(){
      if(!chartCanvas) return;
      const rect=chartCanvas.parentElement.getBoundingClientRect();
      chartCanvas.width=rect.width-4; chartCanvas.height=480;
      chartContext && drawChart();
    }
    function createChartLegend(){
      const legend=document.getElementById('chartLegend');
      legend.innerHTML='';
      cryptoConfig.forEach((c,idx)=>{
        const item=document.createElement('div');
        item.className='legend-item';
        item.innerHTML=`<div class="legend-color" style="background-color:${c.color}"></div><span>${c.name}</span>`;
        item.addEventListener('click',()=>{ c.visible=!c.visible; item.style.opacity=c.visible?'1':'.35'; drawChart() });
        legend.appendChild(item);
      });
    }
    function generateAllCosmosData(){
      cryptoConfig.forEach(c=>{
        const data=generateCosmosData(c,100);
        currentData.set(c.id,data);
      });
    }
    function generateCosmosData(crypto,points){
      const data=[]; const now=Date.now(); const interval=3600000;
      let price=crypto.basePrice, base=price;
      for(let i=points;i>=0;i--){
        const ts=now-i*interval; const hr=new Date(ts).getHours();
        let v=.015; if(hr>=8&&hr<=16) v=.025; if(hr>=14&&hr<=22) v=.035;
        price*=(1+(Math.random()-.5)*v);
        const trend=Math.sin((i/30)*Math.PI)*.001; price*=(1+trend);
        if(price>1.4*base) price=1.35*base; if(price<.6*base) price=.65*base;
        data.push({timestamp:ts,price:Math.max(price,.001)});
      }
      return data.sort((a,b)=>a.timestamp-b.timestamp);
    }
    let raf=0;
    function startChartAnimation(){
      cancelAnimationFrame(raf);
      const loop=()=>{ drawChart(); raf=requestAnimationFrame(loop) };
      loop();
    }
    function drawChart(){
      if(!chartContext||!chartCanvas) return;
      const ctx=chartContext, w=chartCanvas.width, h=chartCanvas.height;
      ctx.clearRect(0,0,w,h);
      const bg=ctx.createLinearGradient(0,0,0,h);
      bg.addColorStop(0,'rgba(139, 92, 246, 0.15)');
      bg.addColorStop(.5,'rgba(59, 130, 246, 0.08)');
      bg.addColorStop(1,'rgba(0, 0, 0, 0.4)');
      ctx.fillStyle=bg; ctx.fillRect(0,0,w,h);

      drawGrid(ctx,w,h);

      cryptoConfig.forEach(c=>{
        const d=currentData.get(c.id);
        if(!d||!c.visible) return;
        drawSeries(ctx,c,d,w,h);
      });
    }
    function drawGrid(ctx,w,h){
      const m={left:40,right:80,top:30,bottom:40};
      const cw=w-m.left-m.right, ch=h-m.top-m.bottom;
      ctx.strokeStyle='rgba(139, 92, 246, 0.15)'; ctx.lineWidth=.5;
      for(let i=0;i<=12;i++){ const x=m.left+(i/12)*cw; ctx.beginPath(); ctx.moveTo(x,m.top); ctx.lineTo(x,h-m.bottom); ctx.stroke() }
      for(let i=0;i<=8;i++){ const y=m.top+(i/8)*ch; ctx.beginPath(); ctx.moveTo(m.left,y); ctx.lineTo(w-m.right,y); ctx.stroke() }
    }
    function drawSeries(ctx,crypto,data,w,h){
      const m={left:40,right:80,top:30,bottom:40};
      const cw=w-m.left-m.right, ch=h-m.top-m.bottom;
      const prices=data.map(d=>d.price);
      const min=Math.min(...prices), max=Math.max(...prices), range=max-min||1;
      const tr=data[data.length-1].timestamp-data[0].timestamp;

      ctx.strokeStyle=crypto.color; ctx.lineWidth=2.5; ctx.lineCap='round'; ctx.lineJoin='round';
      ctx.shadowColor=crypto.color; ctx.shadowBlur=8;
      ctx.beginPath();
      data.forEach((p,i)=>{
        const x=m.left+((p.timestamp-data[0].timestamp)/tr)*cw;
        const y=m.top+(ch-((p.price-min)/range)*ch);
        if(i===0) ctx.moveTo(x,y); else {
          const prev=data[i-1];
          const px=m.left+((prev.timestamp-data[0].timestamp)/tr)*cw;
          const py=m.top+(ch-((prev.price-min)/range)*ch);
          const cx=(px+x)/2; ctx.quadraticCurveTo(cx,py,x,y);
        }
      });
      ctx.stroke();

      const last=data[data.length-1];
      const lx=m.left+((last.timestamp-data[0].timestamp)/tr)*cw;
      const ly=m.top+(ch-((last.price-min)/range)*ch);
      ctx.beginPath(); ctx.arc(lx,ly,5,0,Math.PI*2); ctx.fillStyle=crypto.color; ctx.fill();
      ctx.fillStyle=crypto.color; ctx.font='12px Orbitron, monospace'; ctx.textAlign='left';
      ctx.fillText(`${last.price.toFixed(crypto.basePrice<1?4:0)}`, lx+10, ly+4);
      ctx.shadowBlur=0; ctx.textAlign='start';
    }
    function updateCosmosData(){
      cryptoConfig.forEach(c=>{
        const d=currentData.get(c.id); if(!d||!d.length) return;
        const last=d[d.length-1]; const now=Date.now();
        const varr=(Math.random()-.5)*.04; const wave=Math.sin(now/30000)*.01; const bias=(Math.random()-.48)*.02;
        const total=varr+wave+bias; const next={timestamp:now, price:Math.max(last.price*(1+total),.001)};
        d.push(next); if(d.length>120) d.shift();
      });
      drawChart();
      // 시장총액 느낌값
      document.getElementById('marketCap').textContent=`COSMOS Live: ${ (2.31*(1+Math.random()*.05)).toFixed(2) }T`;
    }
    function startRealTimeUpdates(){ setInterval(updateCosmosData,2000) }
    document.addEventListener('DOMContentLoaded',()=>{ setTimeout(()=>{ initCosmosChart() },300) });

    /* 간단한 이벤트 */
    document.getElementById('timeSelector')?.addEventListener('change',()=>generateAllCosmosData());
    document.getElementById('chartType')?.addEventListener('change',e=>{ if(e.target.value==='single'){ alert('단일 궤도 모드는 곧 출시됩니다!'); e.target.value='multi' } });
  </script>
</body>
</html>
