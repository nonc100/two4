<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Seed Chat</title>
  <style>
    body { margin:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial; background:#090013; color:#fff; }
    .wrap { max-width:720px; margin:0 auto; padding:16px 16px 120px; }
    header { position:sticky; top:0; background:#090013; padding:16px 0; }
    h1 { margin:0; font-size:18px; color:#b78bff }
    #messages { display:flex; flex-direction:column; gap:10px; }
    .row { display:flex; }
    .row.user { justify-content:flex-end; }
    .bubble { max-width:80%; padding:10px 12px; border-radius:12px; line-height:1.45; word-break:break-word; }
    .user .bubble { background:#3a1a8c; }
    .ai .bubble { background:rgba(255,255,255,0.08); border:1px solid rgba(255,255,255,0.1) }
    footer { position:fixed; left:0; right:0; bottom:0; background:rgba(9,0,19,0.96); border-top:1px solid rgba(255,255,255,0.08); }
    .inputbar { max-width:720px; margin:0 auto; display:flex; gap:8px; padding:12px 16px; }
    input[type=text] { flex:1; background:#14042c; color:#fff; border:1px solid rgba(255,255,255,0.12); border-radius:10px; padding:12px }
    button { background:#8e44ad; color:#fff; border:0; border-radius:10px; padding:0 16px; font-weight:600; cursor:pointer; }
    button:disabled { opacity:.6; cursor:default }
    .hint { color:#ae9bd6; font-size:12px; margin-top:6px }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Seed · Q&A (gpt-4o)</h1>
      <div class="hint">짧게 질문 → 보내기. 서버는 <code>/api/gpt-4o</code>에 POST로 연결돼 있어요.</div>
    </header>

    <main id="messages"></main>
  </div>

  <footer>
    <div class="inputbar">
      <input id="userInput" type="text" placeholder="Seed에게 물어보기…" />
      <button id="sendBtn">보내기</button>
    </div>
  </footer>

  <script>
    // 대화 프롬프트: 필요하면 문구 수정
    let messages = [
      { role: "system", content: "너는 Seed라는 AI고, 따뜻하고 유머러스하게 한국어로 간결히 답한다." }
    ];

    const $msgs = document.getElementById("messages");
    const $input = document.getElementById("userInput");
    const $send  = document.getElementById("sendBtn");

    function addBubble(role, text) {
      const row = document.createElement("div");
      row.className = "row " + (role === "user" ? "user" : "ai");
      const b = document.createElement("div");
      b.className = "bubble";
      b.textContent = text;
      row.appendChild(b);
      $msgs.appendChild(row);
      // 스크롤 하단 고정
      window.scrollTo({ top: document.body.scrollHeight, behavior: "smooth" });
    }

    async function sendMessage() {
      const text = ($input.value || "").trim();
      if (!text) return;
      // 사용자 메시지 표시 + 누적
      addBubble("user", text);
      messages.push({ role: "user", content: text });
      $input.value = "";
      $input.focus();
      $send.disabled = true;

      try {
        const res = await fetch("/api/gpt-4o", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ messages })
        });

        const data = await res.json();

        if (!res.ok) {
          addBubble("ai", `⚠️ 오류: ${data?.error || "서버 오류"}`);
        } else {
          const reply = data?.reply
            ?? data?.raw?.choices?.[0]?.message?.content
            ?? "응답을 읽지 못했어요.";
          addBubble("ai", reply);
          messages.push({ role: "assistant", content: reply });
        }
      } catch (err) {
        addBubble("ai", `⚠️ 네트워크 오류: ${err?.message || err}`);
      } finally {
        $send.disabled = false;
      }
    }

    $send.addEventListener("click", sendMessage);
    $input.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.shiftKey) sendMessage();
    });
  </script>
</body>
</html>
